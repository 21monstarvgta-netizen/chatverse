<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ChatVerse โ ะงะตัะตะผััะบะธ</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css?v=5">
  <link rel="stylesheet" href="/css/game.css?v=5">
</head>
<body>
  <div id="toast-container" class="toast-container"></div>

  <div id="game-loading" class="game-loading">
    <div class="game-loading-content">
      <div class="game-loading-icon">๐๏ธ</div>
      <h2>ะงะตัะตะผััะบะธ</h2>
      <p>ะะฐะณััะทะบะฐ ะฒะฐัะตะณะพ ะณะพัะพะดะฐ...</p>
      <div class="spinner"></div>
    </div>
  </div>

  <div id="game-app" class="game-app hidden">
    <!-- Top Resource Bar -->
    <div class="game-topbar">
      <div class="topbar-left">
  <button class="game-back-btn" id="game-back-btn">โ ะงะฐั</button>
  <div class="city-name-wrapper">
    <span id="city-name" class="city-name">ะะพะน ะณะพัะพะด</span>
    <button class="city-rename-btn" id="city-rename-btn" title="ะะตัะตะธะผะตะฝะพะฒะฐัั">โ๏ธ</button>
    <button class="city-rename-btn" id="game-reset-btn" title="ะกะฑัะพั ะฟัะพะณัะตััะฐ">๐</button>
  </div>
</div>
      <div class="topbar-right">
        <div class="topbar-level">
          <span class="level-badge" id="level-badge">ะฃั. 1</span>
          <div class="xp-bar-mini">
            <div class="xp-bar-fill" id="xp-bar-fill" style="width:0%"></div>
          </div>
        </div>
        <button class="game-center-btn" id="game-center-btn" title="ะ ัะตะฝัั">๐</button>
        <button class="game-center-btn" id="normalize-territory-btn" title="ะะพัะผะฐะปะธะทะพะฒะฐัั ัะตััะธัะพัะธั ะฒ ะฟััะผะพัะณะพะปัะฝะธะบ" style="font-size:14px;" onclick="game && game.normalizeTerritory()">โฌ</button>
      </div>
    </div>

    <div class="game-resources-bar" id="resources-bar">
      <div class="res-item" title="ะะพะฝะตัั"><span class="res-icon">๐ช</span><span id="res-coins">0</span></div>
      <div class="res-item" title="ะะดะฐ"><span class="res-icon">๐</span><span id="res-food">0</span></div>
      <div class="res-item" title="ะะฐัะตัะธะฐะปั"><span class="res-icon">๐ชจ</span><span id="res-materials">0</span></div>
      <div class="res-item" title="ะญะฝะตัะณะธั"><span class="res-icon">โก</span><span id="res-energy">0/0</span></div>
      <div class="res-item" title="ะะฐัะตะปะตะฝะธะต"><span class="res-icon">๐ฅ</span><span id="res-population">0</span></div>
      <div class="res-item" title="ะัะธััะฐะปะปั (ะฝะฐะถะผะธ ะดะปั ะพะฑะผะตะฝะฐ)" onclick="game && game.showCrystalExchange()" style="cursor:pointer;" ><span class="res-icon">๐</span><span id="res-crystals">0</span><span style="font-size:10px;opacity:0.6;">โ</span></div>
    </div>

    <!-- Main Game Area -->
    <div class="game-viewport" id="game-viewport">
      <canvas id="game-canvas"></canvas>
    </div>

    <!-- Placing mode banner -->
    <div class="placing-banner hidden" id="placing-banner">
      <span>๐ ะัะฑะตัะธัะต ะบะปะตัะบั ะดะปั ัััะพะธัะตะปัััะฒะฐ</span>
      <button class="btn btn-secondary btn-sm" id="cancel-placing">โ ะัะผะตะฝะฐ</button>
    </div>


    <!-- Move building banner -->
    <div class="placing-banner hidden" id="move-banner" style="background: linear-gradient(135deg, #fdcb6e, #e17055);">
      <span>๐๏ธ ะัะฑะตัะธัะต ะฝะพะฒะพะต ะผะตััะพ ะดะปั ะทะดะฐะฝะธั</span>
      <button class="btn btn-secondary btn-sm" onclick="game.cancelMoving()">โ ะัะผะตะฝะฐ</button>
    </div>
    <!-- Building Info Panel -->
    <div class="building-info-panel hidden" id="building-info-panel">
      <div class="building-info-header">
        <span id="building-info-emoji" class="building-info-emoji">๐</span>
        <div>
          <h3 id="building-info-name">ะะดะฐะฝะธะต</h3>
          <span id="building-info-level" class="building-info-level">ะฃั. 1</span>
        </div>
        <button class="panel-close" id="close-building-info">โ</button>
      </div>
      <div class="building-info-body">
        <div id="building-info-output" class="building-info-row"></div>
        <div id="building-info-timer" class="building-info-row"></div>
        <div class="building-info-actions" id="building-info-actions"></div>
      </div>
    </div>

    <!-- Bottom Build Menu -->
    <div class="game-bottom-bar">
      <button class="bottom-tab active" data-tab="build" id="tab-build">๐๏ธ ะกััะพะธัั</button>
      <button class="bottom-tab" data-tab="quests" id="tab-quests">๐ ะะฒะตััั<span class="quest-badge hidden" id="quest-badge">0</span></button>
      <button class="bottom-tab" data-tab="social" id="tab-social">๐ ะะพัะพะดะฐ</button>
      <button class="bottom-tab" data-tab="collect" id="tab-collect">๐ฐ ะกะพะฑัะฐัั</button>
    </div>

    <!-- Build Panel -->
    <div class="game-panel" id="panel-build">
      <div class="panel-header">
        <h3>๐๏ธ ะะพัััะพะธัั</h3>
        <button class="panel-close" id="close-build-panel">โ</button>
      </div>
      <!-- Size filter tabs -->
      <div style="display:flex;gap:4px;padding:4px 8px;border-bottom:1px solid rgba(255,255,255,0.08);">
        <button class="build-size-btn active" data-size="all" style="flex:1;padding:4px 2px;background:rgba(108,92,231,0.3);border:1px solid rgba(108,92,231,0.5);border-radius:6px;color:#a29bfe;font-size:10px;cursor:pointer;">๐ฆ ะัะต</button>
        <button class="build-size-btn" data-size="1x1" style="flex:1;padding:4px 2px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#94a3b8;font-size:10px;cursor:pointer;">1ร1</button>
        <button class="build-size-btn" data-size="large" style="flex:1;padding:4px 2px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:#94a3b8;font-size:10px;cursor:pointer;">๐ข 2ร2+</button>
      </div>
      <div class="build-categories" id="build-categories">
        <button class="build-cat-btn active" data-cat="all">ะัะต</button>
        <button class="build-cat-btn" data-cat="production">ะะตััััั</button>
        <button class="build-cat-btn" data-cat="residential">ะะธะปัั</button>
        <button class="build-cat-btn" data-cat="commercial">ะะธะทะฝะตั</button>
        <button class="build-cat-btn" data-cat="infrastructure">ะะฝััะฐ</button>
        <button class="build-cat-btn" data-cat="special">ะัะพะฑัะต</button>
        <button class="build-cat-btn" data-cat="decoration">ะะตะบะพั</button>
      </div>
      <div class="build-list" id="build-list"></div>
    </div>

    <!-- Quests Panel -->
    <div class="game-panel hidden" id="panel-quests">
      <div class="panel-header">
        <h3>๐ ะะฒะตััั</h3>
        <button class="panel-close" id="close-quests-panel">โ</button>
      </div>
      <!-- Quest tabs -->
      <div class="quest-tabs">
        <button class="quest-tab active" id="tab-story-quests" onclick="game && game.ui.switchQuestTab('story')">๐ ะััะพัะธั</button>
        <button class="quest-tab" id="tab-daily-quests" onclick="game && game.ui.switchQuestTab('daily')">๐ ะะถะตะดะฝะตะฒะฝัะต<span class="daily-badge hidden" id="daily-badge">!</span></button>
      </div>
      <div id="quest-story-section">
        <div class="quests-list" id="quests-list"></div>
      </div>
      <div id="quest-daily-section" class="hidden">
        <div id="daily-quests-list"></div>
      </div>
    </div>

    <!-- Social Panel -->
    <div class="game-panel hidden" id="panel-social">
      <div class="panel-header">
        <h3>๐ ะะพัะพะดะฐ ะธะณัะพะบะพะฒ</h3>
        <button class="panel-close" id="close-social-panel">โ</button>
      </div>
      <div class="leaderboard-list" id="leaderboard-list"></div>
    </div>

    <!-- Zone unlock modal -->
    <div class="zone-unlock-modal hidden" id="zone-unlock-modal">
      <div class="zone-unlock-content">
        <h3>๐บ๏ธ ะัะบัััั ัะตััะธัะพัะธั</h3>
        <p id="zone-unlock-info"></p>
        <div class="zone-unlock-actions">
          <button class="btn btn-secondary btn-sm" id="zone-cancel">ะัะผะตะฝะฐ</button>
          <button class="btn btn-primary btn-sm" id="zone-confirm" style="width:auto;">ะัะบัััั</button>
        </div>
      </div>
    </div>


    <!-- Crystal Exchange Modal -->
    <div class="zone-unlock-modal hidden" id="crystal-exchange-modal">
      <div class="zone-unlock-content">
        <h3>๐ ะะฑะผะตะฝ ะบัะธััะฐะปะปะพะฒ</h3>
        <p style="color:#a29bfe;">1 ๐ ะบัะธััะฐะปะป = 100 ะปัะฑะพะณะพ ัะตััััะฐ</p>
        <p>ะะฐัะธ ะบัะธััะฐะปะปั: <strong id="crystal-exchange-have">0</strong> ๐</p>
        <div style="margin:10px 0;">
          <label style="color:var(--text-muted);font-size:13px;">ะะพะปะธัะตััะฒะพ ะบัะธััะฐะปะปะพะฒ:</label><br>
          <input type="number" id="crystal-amount" min="1" value="1" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--border);background:var(--surface);color:var(--text);margin-top:4px;" oninput="game.updateCrystalExchangePreview()">
        </div>
        <div style="margin:10px 0;">
          <label style="color:var(--text-muted);font-size:13px;">ะะพะปััะธัั ัะตัััั:</label><br>
          <select id="crystal-resource" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--border);background:var(--surface);color:var(--text);margin-top:4px;" onchange="game.updateCrystalExchangePreview()">
            <option value="coins">๐ช ะะพะฝะตัั</option>
            <option value="food">๐ ะะดะฐ</option>
            <option value="materials">๐ชจ ะะฐัะตัะธะฐะปั</option>
          </select>
        </div>
        <div id="crystal-exchange-preview" style="text-align:center;font-size:16px;font-weight:bold;color:#55efc4;margin:12px 0;">1 ๐ โ 100 ๐ช</div>
        <div class="zone-unlock-actions">
          <button class="btn btn-secondary btn-sm" onclick="document.getElementById('crystal-exchange-modal').classList.add('hidden')">ะัะผะตะฝะฐ</button>
          <button class="btn btn-primary btn-sm" style="width:auto;" onclick="game.confirmCrystalExchange()">๐ ะะฑะผะตะฝััั</button>
        </div>
      </div>
    </div>

    <!-- Threat Alert Banner -->
    <div id="threat-alert-panel" class="threat-alert-panel hidden">
      <span id="threat-alert-emoji" style="font-size:24px;">๐ป</span>
      <div>
        <div id="threat-alert-name" style="font-weight:700;color:#fca5a5;">ะัะฐะณ ะฝะฐะฟะฐะดะฐะตั!</div>
        <div id="threat-alert-desc" style="font-size:12px;color:#fef2f2;">ะะฐะถะผะธ ะฝะฐ ะฒัะฐะณะฐ ะฝะฐ ะบะฐััะต!</div>
      </div>
    </div>

    <!-- Threat Combat Panel -->
    <div id="threat-combat-panel" class="threat-combat-panel hidden">
      <div class="threat-combat-header">
        <span id="threat-combat-emoji" style="font-size:32px;">๐ป</span>
        <div>
          <div id="threat-combat-name" style="font-size:16px;font-weight:700;color:#fca5a5;">ะะตะดะฒะตะดั</div>
          <div style="font-size:11px;color:var(--text-muted);">ะัะฐะบัะตั ัะฒะพะน ะณะพัะพะด!</div>
        </div>
        <button id="threat-combat-close" class="btn btn-ghost btn-sm" style="margin-left:auto;">โ</button>
      </div>
      <div style="margin:10px 0;">
        <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:4px;">
          <span>โค๏ธ ะะดะพัะพะฒัะต</span>
          <span id="threat-hp-text">3/3 HP</span>
        </div>
        <div style="background:rgba(255,255,255,0.1);border-radius:8px;height:10px;overflow:hidden;">
          <div id="threat-hp-bar" style="height:100%;width:100%;background:#22c55e;border-radius:8px;transition:width 0.3s;"></div>
        </div>
      </div>
      <button id="threat-attack-btn" class="btn btn-primary" style="width:100%;background:linear-gradient(135deg,#ef4444,#dc2626);">
        โ๏ธ ะัะฐะบะพะฒะฐัั!
      </button>
    </div>
    <!-- Visit mode banner -->
    <div class="visit-banner hidden" id="visit-banner">
      <span id="visit-banner-text">ะัะพัะผะพัั ะณะพัะพะดะฐ</span>
      <button class="btn btn-secondary btn-sm" id="visit-back">โ ะะพะน ะณะพัะพะด</button>
    </div>
  </div>

  <!-- Visit Building Info Popup -->
  <div class="zone-unlock-modal hidden" id="visit-building-modal">
    <div class="zone-unlock-content" style="max-width:320px;">
      <div style="font-size:36px;text-align:center;margin-bottom:8px;" id="visit-bld-emoji">๐</div>
      <h3 style="text-align:center;margin:0 0 4px;" id="visit-bld-name">ะะดะฐะฝะธะต</h3>
      <div style="text-align:center;color:var(--text-muted);font-size:12px;margin-bottom:12px;" id="visit-bld-owner"></div>
      <div style="background:rgba(0,0,0,0.2);border-radius:8px;padding:10px;margin-bottom:12px;" id="visit-bld-info"></div>
      <button class="btn btn-secondary btn-sm" style="width:100%;" onclick="document.getElementById('visit-building-modal').classList.add('hidden')">ะะฐะบัััั</button>
    </div>
  </div>

  <!-- Admin Panel Modal -->
  <div class="zone-unlock-modal hidden" id="admin-panel-modal">
    <div class="zone-unlock-content" style="max-width:420px;max-height:80vh;overflow-y:auto;">
      <div class="panel-header" style="margin-bottom:12px;">
        <h3>โ๏ธ ะะฐะฝะตะปั ะฐะดะผะธะฝะธัััะฐัะพัะฐ</h3>
        <button class="panel-close" onclick="document.getElementById('admin-panel-modal').classList.add('hidden')">โ</button>
      </div>

      <!-- Create daily quest -->
      <div style="background:rgba(0,0,0,0.2);border-radius:10px;padding:14px;margin-bottom:14px;">
        <h4 style="margin:0 0 10px;color:#fbbf24;">๐ ะกะพะทะดะฐัั ะตะถะตะดะฝะตะฒะฝัะน ะบะฒะตัั</h4>
        <div style="display:flex;flex-direction:column;gap:8px;">
          <input type="text" id="adm-title" placeholder="ะะฐะทะฒะฐะฝะธะต ะบะฒะตััะฐ" class="game-input" />
          <input type="text" id="adm-desc" placeholder="ะะฟะธัะฐะฝะธะต (ะฝะฐะฟั: ะะพัััะพะนัะต 2 ัะตัะผั)" class="game-input" />
          <select id="adm-type" class="game-input">
            <option value="build">ะะพัััะพะธัั ะทะดะฐะฝะธะต</option>
            <option value="collect">ะกะพะฑัะฐัั ัะตัััั</option>
            <option value="upgrade">ะฃะปัััะธัั ะทะดะฐะฝะธะต</option>
            <option value="spend">ะะพััะฐัะธัั ัะตัััั</option>
            <option value="unlock_zone">ะัะบัััั ะทะพะฝั</option>
            <option value="reach_population">ะะพััะธัั ะฝะฐัะตะปะตะฝะธะต</option>
          </select>
          <input type="text" id="adm-target" placeholder="ะฆะตะปั: farm / coins / any / zone" class="game-input" />
          <input type="number" id="adm-count" placeholder="ะะพะปะธัะตััะฒะพ (ะฝะฐะฟั: 3)" class="game-input" min="1" />
          <div style="color:var(--text-muted);font-size:11px;margin-top:2px;">ะะฐะณัะฐะดะฐ:</div>
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;">
            <input type="number" id="adm-r-coins" placeholder="๐ช ะะพะฝะตัั" class="game-input" min="0" />
            <input type="number" id="adm-r-food" placeholder="๐ ะะดะฐ" class="game-input" min="0" />
            <input type="number" id="adm-r-materials" placeholder="๐ชจ ะะฐัะตั." class="game-input" min="0" />
            <input type="number" id="adm-r-crystals" placeholder="๐ ะัะธัั." class="game-input" min="0" />
            <input type="number" id="adm-r-exp" placeholder="โจ ะะฟัั" class="game-input" min="0" />
          </div>
          <button class="btn btn-primary btn-sm" style="width:100%;" onclick="game && game.adminCreateDailyQuest()">โ ะกะพะทะดะฐัั ะบะฒะตัั (24ั)</button>
        </div>
      </div>

      <!-- Existing daily quests management -->
      <div style="background:rgba(0,0,0,0.2);border-radius:10px;padding:14px;margin-bottom:14px;">
        <h4 style="margin:0 0 10px;color:#fbbf24;">๐ ะะบัะธะฒะฝัะต ะตะถะตะดะฝะตะฒะฝัะต ะบะฒะตััั</h4>
        <div id="adm-daily-list"><div style="color:var(--text-muted);font-size:12px;">ะะฐะณััะทะบะฐ...</div></div>
      </div>

      <!-- Set currency (existing) -->
      <div style="background:rgba(0,0,0,0.2);border-radius:10px;padding:14px;">
        <h4 style="margin:0 0 10px;color:#fbbf24;">๐ฐ ะะทะผะตะฝะธัั ะฒะฐะปััั ะธะณัะพะบั</h4>
        <div style="display:flex;flex-direction:column;gap:8px;">
          <input type="text" id="adm-username" placeholder="ะะผั ะธะณัะพะบะฐ" class="game-input" />
          <select id="adm-currency" class="game-input">
            <option value="coins">๐ช ะะพะฝะตัั</option>
            <option value="food">๐ ะะดะฐ</option>
            <option value="materials">๐ชจ ะะฐัะตัะธะฐะปั</option>
            <option value="crystals">๐ ะัะธััะฐะปะปั</option>
          </select>
          <input type="number" id="adm-amount" placeholder="ะะพะปะธัะตััะฒะพ" class="game-input" min="0" />
          <button class="btn btn-primary btn-sm" style="width:100%;" onclick="game && game.adminSetCurrency()">ะัะธะผะตะฝะธัั</button>
        </div>
      </div>
    </div>
  </div>

  <script src="/js/utils.js?v=11"></script>
  <script src="/js/gameRenderer.js?v=12"></script>
  <script src="/js/gameUI.js?v=11"></script>
  <script src="/js/threatManager.js?v=11"></script>
  <script src="/js/game.js?v=11"></script>
</body>
</html>