<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ChatVerse</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css?_=20250101">
</head>
<body>
  <div id="loading-screen" class="loading-screen"><div class="spinner"></div><p>–ó–∞–≥—Ä—É–∑–∫–∞ ChatVerse...</p></div>
  <div id="toast-container" class="toast-container"></div>
  <div id="sidebar-overlay" class="sidebar-overlay"></div>

  <div id="chat-app" class="chat-layout hidden">
    <aside id="sidebar" class="sidebar">
      <div class="sidebar-header">
        <div class="logo"><div class="logo-mini">üí¨</div><h2>ChatVerse</h2></div>
        <div class="sidebar-header-actions">
          <button class="btn-icon" id="btn-posts" title="–ü–æ—Å—Ç—ã">üìù</button>
          <button class="btn-icon" id="btn-profile" title="–ü—Ä–æ—Ñ–∏–ª—å">üë§</button>
          <button class="btn-icon" id="btn-logout" title="–í—ã–π—Ç–∏">üö™</button>
        </div>
      </div>
      <nav class="sidebar-nav">
        <button class="nav-item active" id="nav-general" data-view="general"><span class="nav-icon">üåç</span><span>–û–±—â–∏–π —á–∞—Ç</span></button>
      </nav>
      <div class="sidebar-section">
        <div class="section-header"><h3>–ö–æ–º–Ω–∞—Ç—ã</h3><button id="btn-create-room" title="–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É">‚ûï</button></div>
        <div id="rooms-list"></div>
      </div>
      <div class="sidebar-profile" id="sidebar-user-profile"></div>
    </aside>

    <main class="chat-main">
      <header class="chat-header">
        <div class="chat-header-info">
          <button class="mobile-menu-btn" id="mobile-menu-btn">‚ò∞</button>
          <div><h2 id="chat-title">üåç –û–±—â–∏–π —á–∞—Ç</h2><span class="online-count" id="online-count">0 –æ–Ω–ª–∞–π–Ω</span></div>
        </div>
        <div class="chat-header-actions" id="chat-header-actions"></div>
      </header>
      <!-- Pinned messages bar -->
      <div class="pinned-bar hidden" id="pinned-bar" onclick="app.scrollToPinnedMessage()">
        <span class="pinned-icon">üìå</span>
        <span class="pinned-text" id="pinned-text">–ó–∞–∫—Ä–µ–ø–ª—ë–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</span>
        <button class="pinned-close" onclick="event.stopPropagation();document.getElementById('pinned-bar').classList.add('hidden')">‚úï</button>
      </div>
      <div class="messages-container" id="messages-container">
        <div class="empty-state"><div class="empty-icon">üí¨</div><h3>–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</h3><p>–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –Ω–∞–ø–∏—à–µ—Ç!</p></div>
      </div>
      <div class="typing-indicator" id="typing-indicator"></div>
      <div class="message-input-area">
        <div class="message-input-wrapper" style="position:relative;">
          <div class="chat-toolbar">
            <button class="toolbar-btn" id="btn-emoji" title="–≠–º–æ–¥–∑–∏">üòä</button>
            <label class="toolbar-btn" id="btn-image" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ">üñºÔ∏è
              <input type="file" id="image-upload-input" accept="image/*" style="display:none;">
            </label>
            <button class="toolbar-btn" id="btn-shopping" title="–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫">üõí</button>
            <button class="toolbar-btn" id="btn-dice" title="–ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫">üé≤</button>
          </div>
          <textarea class="message-input" id="message-input" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..." rows="1" maxlength="5000"></textarea>
          <button class="send-btn" id="send-btn" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">‚û§</button>
          <div id="emoji-picker" class="emoji-picker hidden"></div>
          <div id="dice-picker" class="dice-picker hidden"></div>
        </div>
        <!-- Edit bar -->
        <div id="edit-bar" class="edit-bar hidden">
          <span>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
          <button onclick="app.cancelEdit()">‚úï</button>
        </div>
      </div>
    </main>

    <aside class="online-panel" id="online-panel">
      <div class="online-panel-header"><h3>–û–Ω–ª–∞–π–Ω <span class="count" id="online-panel-count">0</span></h3></div>
      <div class="online-users-list" id="online-users-list"></div>
    </aside>
  </div>

  <!-- Create Room Modal -->
  <div id="create-room-modal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header"><h2>–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</h2><button class="modal-close" id="close-create-room">‚úï</button></div>
      <div class="modal-body">
        <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" class="form-input no-icon" id="room-name-input" placeholder="–ú–æ—è –∫–æ–º–Ω–∞—Ç–∞" maxlength="50"></div>
        <div class="form-group"><label>–û–ø–∏—Å–∞–Ω–∏–µ</label><input type="text" class="form-input no-icon" id="room-desc-input" placeholder="–û —á—ë–º —ç—Ç–∞ –∫–æ–º–Ω–∞—Ç–∞" maxlength="200"></div>
        <div class="form-group"><label>–£—á–∞—Å—Ç–Ω–∏–∫–∏</label>
          <div class="search-input-wrapper"><span class="search-icon">üîç</span><input type="text" id="member-search" placeholder="–ü–æ–∏—Å–∫..."></div>
          <div class="users-checkbox-list" id="members-checkbox-list"></div>
        </div>
      </div>
      <div class="modal-footer"><button class="btn btn-secondary" id="cancel-create-room">–û—Ç–º–µ–Ω–∞</button><button class="btn btn-primary" style="width:auto" id="confirm-create-room">–°–æ–∑–¥–∞—Ç—å</button></div>
    </div>
  </div>

  <!-- Room Info Modal -->
  <div id="room-info-modal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header"><h2 id="room-info-title">–ö–æ–º–Ω–∞—Ç–∞</h2><button class="modal-close" id="close-room-info">‚úï</button></div>
      <div class="modal-body">
        <p id="room-info-desc" style="color:var(--text-secondary);margin-bottom:16px;"></p>
        <h3 style="font-size:14px;color:var(--text-muted);margin-bottom:12px;text-transform:uppercase;">–£—á–∞—Å—Ç–Ω–∏–∫–∏</h3>
        <div id="room-members-list" class="users-checkbox-list" style="max-height:400px;"></div>
        <div id="room-admin-actions" class="mt-4" style="display:flex;gap:8px;flex-wrap:wrap;"></div>
      </div>
    </div>
  </div>

  <!-- Add Member Modal -->
  <div id="add-member-modal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header"><h2>–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</h2><button class="modal-close" id="close-add-member">‚úï</button></div>
      <div class="modal-body">
        <div class="search-input-wrapper"><span class="search-icon">üîç</span><input type="text" id="add-member-search" placeholder="–ü–æ–∏—Å–∫..."></div>
        <div class="users-checkbox-list" id="add-members-list"></div>
      </div>
      <div class="modal-footer"><button class="btn btn-secondary" id="cancel-add-member">–û—Ç–º–µ–Ω–∞</button><button class="btn btn-primary" style="width:auto" id="confirm-add-member">–î–æ–±–∞–≤–∏—Ç—å</button></div>
    </div>
  </div>

  <!-- Shopping List Modal -->
  <div id="shopping-modal" class="modal-overlay hidden">
    <div class="modal" style="max-width:600px;">
      <div class="modal-header"><h2>üõí –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</h2><button class="modal-close" id="close-shopping">‚úï</button></div>
      <div class="modal-body">
        <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞</label><input type="text" class="form-input no-icon" id="shopping-title-input" placeholder="–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫" maxlength="100"></div>
        <label style="font-size:13px;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.5px;">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç—ã</label>
        <div class="shopping-modal-categories" id="shopping-categories"></div>
        <div class="custom-item-row"><input type="text" id="custom-item-input" placeholder="–î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π —Ç–æ–≤–∞—Ä..."><button class="btn btn-secondary btn-sm" id="add-custom-item">‚ûï</button></div>
        <div class="selected-items-preview" id="selected-items-preview"></div>
      </div>
      <div class="modal-footer"><button class="btn btn-secondary" id="cancel-shopping">–û—Ç–º–µ–Ω–∞</button><button class="btn btn-primary" style="width:auto" id="confirm-shopping">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button></div>
    </div>
  </div>

  <!-- Forward Modal -->
  <div id="forward-modal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header"><h2>‚ÜóÔ∏è –ü–µ—Ä–µ—Å–ª–∞—Ç—å –≤</h2><button class="modal-close" id="close-forward">‚úï</button></div>
      <div class="modal-body">
        <div class="forward-targets" id="forward-targets"></div>
      </div>
    </div>
  </div>

  <!-- Message Context Menu -->
  <div id="msg-context-menu" class="context-menu hidden"></div>

  <!-- User Popup -->
  <div id="user-popup" class="user-popup hidden"></div>
  <div id="image-fullscreen" class="image-fullscreen hidden" onclick="this.classList.add('hidden')"><img id="fullscreen-img" src=""></div>

  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script src="/js/utils.js?_=20250101"></script>
  <script src="/js/chat.js?_=20250101"></script>
  <script src="/js/rooms.js?_=20250101"></script>
  <script src="/js/app.js?_=20250101"></script>
</body>
</html>